script(src='https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js')
script.
    var scrollTimer = null;
    var progressTimer = null;
    var loadingBar = document.querySelector(".loading-bar");
    var progress = document.querySelector(".loading-bar .progress");

    document.addEventListener('DOMContentLoaded', function() {
        Barba.Pjax.start()
    })

    Barba.Dispatcher.on('linkClicked',()=>{

        var loadingBarWidth = 20;
        var MAX_LOADING_WIDTH = 95;

        loadingBar.classList.add("loading");
        progress.style.width = loadingBarWidth + "%";

        clearInterval(progressTimer);
        progressTimer = setInterval(()=> {
            loadingBarWidth += 5;
            if (loadingBarWidth > MAX_LOADING_WIDTH) {
            loadingBarWidth = MAX_LOADING_WIDTH;
            }
            progress.style.width = loadingBarWidth + "%";
        }, 500);
    })

    Barba.Dispatcher.on('transitionCompleted',()=>{
        clearInterval(progressTimer);

        progress.style.width = "100%";
        loadingBar.classList.remove("loading");

        setTimeout(()=> {
            progress.style.width = 0;
        }, 400);

        clearInterval(scrollTimer);
        scrollTimer = setInterval(function () {
            var top = document.body.scrollTop || document.documentElement.scrollTop;
            var speed = top / 4;
            if (document.body.scrollTop!=0) {
                document.body.scrollTop -= speed;
            }else {
                document.documentElement.scrollTop -= speed;
            }
            if (top == 0) {
                clearInterval(scrollTimer);
            }
        }, 30); 
    });
    